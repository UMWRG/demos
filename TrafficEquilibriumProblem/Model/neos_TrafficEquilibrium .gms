*Source https://www.gams.com/modlib/libhtml/traffic.htm

$title Traffic Equilibrium Problem (TRAFFIC,SEQ=169)
$Ontext
  Three different models are used to compute traffic equilibria. These are
  a mixed complementarity formulation and a primal and dual formulation
  using NLPs.


Ferris, M C, Meeraus, A, and Rutherford, T F, Computing Wardropian
Equilibria in a Complementarity Framework. Optimization Methods and
Software 10 (1999), 669-685.

$Offtext


* Data exported from Hydra using GAMSplugin.
* (c) Copyright 2015, University of Manchester
*
* SiouxFalls_network: traffic for SiouxFalls
* Network-ID:  56
* Scenario-ID: 56
*******************************************************************************

* Network definition

SETS

i vector of all nodes /
1
10
11
12
13
14
15
16
17
18
19
2
20
21
22
23
24
3
4
5
6
7
8
9
    /

Alias(i,j)

* Node types

SETS

city(i) /
1
10
11
12
13
14
15
16
17
18
19
2
20
21
22
23
24
3
4
5
6
7
8
9
/

SETS

links(i,j) vector of all links /
10 . 11
10 . 15
10 . 16
10 . 17
10 . 9
11 . 10
11 . 12
11 . 14
11 . 4
12 . 11
12 . 13
12 . 3
13 . 12
13 . 24
14 . 11
14 . 15
14 . 23
15 . 10
15 . 14
15 . 19
15 . 22
16 . 10
16 . 17
16 . 18
16 . 8
17 . 10
17 . 16
17 . 19
18 . 16
18 . 20
18 . 7
19 . 15
19 . 17
19 . 20
1 . 2
1 . 3
20 . 18
20 . 19
20 . 21
20 . 22
21 . 20
21 . 22
21 . 24
22 . 15
22 . 20
22 . 21
22 . 23
23 . 14
23 . 22
23 . 24
24 . 13
24 . 21
24 . 23
2 . 1
2 . 6
3 . 1
3 . 12
3 . 4
4 . 11
4 . 3
4 . 5
5 . 4
5 . 6
5 . 9
6 . 2
6 . 5
6 . 8
7 . 18
7 . 8
8 . 16
8 . 6
8 . 7
8 . 9
9 . 10
9 . 5
9 . 8
    /

* Link types

path(i,j) /
10 . 11
10 . 15
10 . 16
10 . 17
10 . 9
11 . 10
11 . 12
11 . 14
11 . 4
12 . 11
12 . 13
12 . 3
13 . 12
13 . 24
14 . 11
14 . 15
14 . 23
15 . 10
15 . 14
15 . 19
15 . 22
16 . 10
16 . 17
16 . 18
16 . 8
17 . 10
17 . 16
17 . 19
18 . 16
18 . 20
18 . 7
19 . 15
19 . 17
19 . 20
1 . 2
1 . 3
20 . 18
20 . 19
20 . 21
20 . 22
21 . 20
21 . 22
21 . 24
22 . 15
22 . 20
22 . 21
22 . 23
23 . 14
23 . 22
23 . 24
24 . 13
24 . 21
24 . 23
2 . 1
2 . 6
3 . 1
3 . 12
3 . 4
4 . 11
4 . 3
4 . 5
5 . 4
5 . 6
5 . 9
6 . 2
6 . 5
6 . 8
7 . 18
7 . 8
8 . 16
8 . 6
8 . 7
8 . 9
9 . 10
9 . 5
9 . 8
/

* Connectivity matrix.
Table Connect(i,j)
         1        10       11       12       13       14       15       16       17       18       19       2        20       21       22       23       24       3        4        5        6        7        8        9        
1        0        0        0        0        0        0        0        0        0        0        0        1        0        0        0        0        0        1        0        0        0        0        0        0        

10       0        0        1        0        0        0        1        1        1        0        0        0        0        0        0        0        0        0        0        0        0        0        0        1        

11       0        1        0        1        0        1        0        0        0        0        0        0        0        0        0        0        0        0        1        0        0        0        0        0        

12       0        0        1        0        1        0        0        0        0        0        0        0        0        0        0        0        0        1        0        0        0        0        0        0        

13       0        0        0        1        0        0        0        0        0        0        0        0        0        0        0        0        1        0        0        0        0        0        0        0        

14       0        0        1        0        0        0        1        0        0        0        0        0        0        0        0        1        0        0        0        0        0        0        0        0        

15       0        1        0        0        0        1        0        0        0        0        1        0        0        0        1        0        0        0        0        0        0        0        0        0        

16       0        1        0        0        0        0        0        0        1        1        0        0        0        0        0        0        0        0        0        0        0        0        1        0        

17       0        1        0        0        0        0        0        1        0        0        1        0        0        0        0        0        0        0        0        0        0        0        0        0        

18       0        0        0        0        0        0        0        1        0        0        0        0        1        0        0        0        0        0        0        0        0        1        0        0        

19       0        0        0        0        0        0        1        0        1        0        0        0        1        0        0        0        0        0        0        0        0        0        0        0        

2        1        0        0        0        0        0        0        0        0        0        0        0        0        0        0        0        0        0        0        0        1        0        0        0        

20       0        0        0        0        0        0        0        0        0        1        1        0        0        1        1        0        0        0        0        0        0        0        0        0        

21       0        0        0        0        0        0        0        0        0        0        0        0        1        0        1        0        1        0        0        0        0        0        0        0        

22       0        0        0        0        0        0        1        0        0        0        0        0        1        1        0        1        0        0        0        0        0        0        0        0        

23       0        0        0        0        0        1        0        0        0        0        0        0        0        0        1        0        1        0        0        0        0        0        0        0        

24       0        0        0        0        1        0        0        0        0        0        0        0        0        1        0        1        0        0        0        0        0        0        0        0        

3        1        0        0        1        0        0        0        0        0        0        0        0        0        0        0        0        0        0        1        0        0        0        0        0        

4        0        0        1        0        0        0        0        0        0        0        0        0        0        0        0        0        0        1        0        1        0        0        0        0        

5        0        0        0        0        0        0        0        0        0        0        0        0        0        0        0        0        0        0        1        0        1        0        0        1        

6        0        0        0        0        0        0        0        0        0        0        0        1        0        0        0        0        0        0        0        1        0        0        1        0        

7        0        0        0        0        0        0        0        0        0        1        0        0        0        0        0        0        0        0        0        0        0        0        1        0        

8        0        0        0        0        0        0        0        1        0        0        0        0        0        0        0        0        0        0        0        0        1        1        0        1        

9        0        1        0        0        0        0        0        0        0        0        0        0        0        0        0        0        0        0        0        1        0        0        1        0        


Parameter x_coord (i)/
1        50000.000
10       220000.000
11       130000.000
12       50000.000
13       50000.000
14       130000.000
15       220000.000
16       320000.000
17       320000.000
18       420000.000
19       320000.000
2        320000.000
20       320000.000
21       220000.000
22       220000.000
23       130000.000
24       130000.000
3        50000.000
4        130000.000
5        220000.000
6        320000.000
7        420000.000
8        320000.000
9        220000.000
/;

Parameter y_coord (i)/
1        510000.000
10       320000.000
11       320000.000
12       320000.000
13       50000.000
14       190000.000
15       190000.000
16       320000.000
17       260000.000
18       320000.000
19       190000.000
2        510000.000
20       50000.000
21       50000.000
22       130000.000
23       130000.000
24       50000.000
3        440000.000
4        440000.000
5        440000.000
6        440000.000
7        380000.000
8        380000.000
9        380000.000
/;

* Network data

* Nodes data

* Array for attribute trip, dimensions are [24]

SETS

trip_index/
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
/
Table trip (i, *)

         1        2        3        4        5        6        7        8        9        10       11       12       13       14       15       16       17       18       19       20       21       22       23       24       
1        0        1        1        5        2        3        5        8        5        13       5        2        5        3        5        5        4        1        3        3        1        4        3        1        
10       13       6        3        12       10       8        19       16       28       0        40       20       19       21       40       44       39       7        18       25       12       26       18       8        
11       5        2        3        14       5        4        5        8        14       40       0        14       10       16       14       14       10       1        4        6        4        11       13       6        
12       2        1        2        6        2        2        7        6        6        20       14       0        13       7        7        7        6        2        3        4        3        7        7        5        
13       5        3        1        6        2        2        4        6        6        19       10       13       0        6        7        6        5        1        3        6        6        13       8        8        
14       3        1        1        5        1        1        2        4        6        21       16       7        6        0        13       7        7        1        3        5        4        12       11       4        
15       5        1        1        5        2        2        5        6        9        40       14       7        7        13       0        12       15       2        8        11       8        26       10       4        
16       5        4        2        8        5        9        14       22       14       44       14       7        6        7        12       0        28       5        13       16       6        12       5        3        
17       4        2        1        5        2        5        10       14       9        39       10       6        5        7        15       28       0        6        17       17       6        17       6        3        
18       1        0        0        1        0        1        2        3        2        7        1        2        1        1        2        5        6        0        3        4        1        3        1        0        
19       3        1        0        2        1        2        4        7        4        18       4        3        3        3        8        13       17       3        0        12       4        12       3        1        
2        1        0        1        2        1        4        2        4        2        6        2        1        3        1        1        4        2        0        1        1        0        1        0        0        
20       3        1        0        3        1        3        5        9        6        25       6        4        6        5        11       16       17       4        12       0        12       24       7        4        
21       1        0        0        2        1        1        2        4        3        12       4        3        6        4        8        6        6        1        4        12       0        18       7        5        
22       4        1        1        4        2        2        5        5        7        26       11       7        13       12       26       12       17       3        12       24       18       0        21       11       
23       3        0        1        5        1        1        2        3        5        18       13       7        8        11       10       5        6        1        3        7        7        21       0        7        
24       1        0        0        2        0        1        1        2        2        8        6        5        8        4        4        3        3        0        1        4        5        11       7        0        
3        1        1        0        2        1        3        1        2        1        3        3        2        1        1        1        2        1        0        0        0        0        1        1        0        
4        5        2        2        0        5        4        4        7        7        12       14       6        6        5        5        8        5        1        2        3        2        4        5        2        
5        2        1        1        5        0        2        2        5        8        10       5        2        2        1        2        5        2        0        1        1        1        2        1        0        
6        3        4        3        4        2        0        4        8        4        8        4        2        2        1        2        9        5        1        2        3        1        2        1        1        
7        5        2        1        4        2        4        0        10       6        19       5        7        4        2        5        14       10       2        4        5        2        5        2        1        
8        8        4        2        7        5        8        10       0        8        16       8        6        6        4        6        22       14       3        7        9        4        5        3        2        
9        5        2        1        7        8        4        6        8        0        28       14       6        6        6        9        14       9        2        4        6        3        7        5        2        


* Links data

Parameter a(i,j)
/        
10 . 11  5        
10 . 15  6        
10 . 16  5        
10 . 17  8        
10 . 9   3        
11 . 10  5        
11 . 12  6        
11 . 14  4        
11 . 4   6        
12 . 11  6        
12 . 13  3        
12 . 3   4        
13 . 12  3        
13 . 24  4        
14 . 11  4        
14 . 15  5        
14 . 23  4        
15 . 10  6        
15 . 14  5        
15 . 19  4        
15 . 22  4        
16 . 10  5        
16 . 17  2        
16 . 18  3        
16 . 8   5        
17 . 10  8        
17 . 16  2        
17 . 19  2        
18 . 16  3        
18 . 20  4        
18 . 7   2        
19 . 15  4        
19 . 17  2        
19 . 20  4        
1 . 2    6        
1 . 3    4        
20 . 18  4        
20 . 19  4        
20 . 21  6        
20 . 22  5        
21 . 20  6        
21 . 22  2        
21 . 24  3        
22 . 15  4        
22 . 20  5        
22 . 21  2        
22 . 23  4        
23 . 14  4        
23 . 22  4        
23 . 24  2        
24 . 13  4        
24 . 21  3        
24 . 23  2        
2 . 1    6        
2 . 6    5        
3 . 1    4        
3 . 12   4        
3 . 4    4        
4 . 11   6        
4 . 3    4        
4 . 5    2        
5 . 4    2        
5 . 6    4        
5 . 9    5        
6 . 2    5        
6 . 5    4        
6 . 8    2        
7 . 18   2        
7 . 8    3        
8 . 16   5        
8 . 6    2        
8 . 7    3        
8 . 9    10       
9 . 10   3        
9 . 5    5        
9 . 8    10       
/;
      
Parameter b(i,j)
/        
10 . 11  0.75     
10 . 15  0.9      
10 . 16  0.75     
10 . 17  1.2      
10 . 9   0.45     
11 . 10  0.75     
11 . 12  0.9      
11 . 14  0.6      
11 . 4   0.9      
12 . 11  0.9      
12 . 13  0.45     
12 . 3   0.6      
13 . 12  0.45     
13 . 24  0.6      
14 . 11  0.6      
14 . 15  0.75     
14 . 23  0.6      
15 . 10  0.9      
15 . 14  0.75     
15 . 19  0.6      
15 . 22  0.6      
16 . 10  0.75     
16 . 17  0.3      
16 . 18  0.45     
16 . 8   0.75     
17 . 10  1.2      
17 . 16  0.3      
17 . 19  0.3      
18 . 16  0.45     
18 . 20  0.6      
18 . 7   0.3      
19 . 15  0.6      
19 . 17  0.3      
19 . 20  0.6      
1 . 2    0.9      
1 . 3    0.6      
20 . 18  0.6      
20 . 19  0.6      
20 . 21  0.9      
20 . 22  0.75     
21 . 20  0.9      
21 . 22  0.3      
21 . 24  0.45     
22 . 15  0.6      
22 . 20  0.75     
22 . 21  0.3      
22 . 23  0.6      
23 . 14  0.6      
23 . 22  0.6      
23 . 24  0.3      
24 . 13  0.6      
24 . 21  0.45     
24 . 23  0.3      
2 . 1    0.9      
2 . 6    0.75     
3 . 1    0.6      
3 . 12   0.6      
3 . 4    0.6      
4 . 11   0.9      
4 . 3    0.6      
4 . 5    0.3      
5 . 4    0.3      
5 . 6    0.6      
5 . 9    0.75     
6 . 2    0.75     
6 . 5    0.6      
6 . 8    0.3      
7 . 18   0.3      
7 . 8    0.45     
8 . 16   0.75     
8 . 6    0.3      
8 . 7    0.45     
8 . 9    1.5      
9 . 10   0.45     
9 . 5    0.75     
9 . 8    1.5      
/;
      
Parameter c(i,j)
/        
10 . 11  10       
10 . 15  13.512   
10 . 16  5.1335   
10 . 17  4.9935   
10 . 9   13.9158  
11 . 10  10       
11 . 12  4.9088   
11 . 14  4.8765   
11 . 4   4.9088   
12 . 11  4.9088   
12 . 13  25.9002  
12 . 3   23.4035  
13 . 12  25.9002  
13 . 24  5.0913   
14 . 11  4.8765   
14 . 15  5.1275   
14 . 23  4.9248   
15 . 10  13.512   
15 . 14  5.1275   
15 . 19  15.6508  
15 . 22  10.315   
16 . 10  5.1335   
16 . 17  5.2299   
16 . 18  19.6799  
16 . 8   5.0458   
17 . 10  4.9935   
17 . 16  5.2299   
17 . 19  4.824    
18 . 16  19.6799  
18 . 20  23.4035  
18 . 7   23.4035  
19 . 15  15.6508  
19 . 17  4.824    
19 . 20  5.0026   
1 . 2    25.9002  
1 . 3    23.4035  
20 . 18  23.4035  
20 . 19  5.0026   
20 . 21  5.0599   
20 . 22  5.0757   
21 . 20  5.0599   
21 . 22  5.2299   
21 . 24  4.8854   
22 . 15  10.315   
22 . 20  5.0757   
22 . 21  5.2299   
22 . 23  5        
23 . 14  4.9248   
23 . 22  5        
23 . 24  5.0785   
24 . 13  5.0913   
24 . 21  4.8854   
24 . 23  5.0785   
2 . 1    25.9002  
2 . 6    4.9582   
3 . 1    23.4035  
3 . 12   23.4035  
3 . 4    17.1105  
4 . 11   4.9088   
4 . 3    17.1105  
4 . 5    17.7828  
5 . 4    17.7828  
5 . 6    4.948    
5 . 9    10       
6 . 2    4.9582   
6 . 5    4.948    
6 . 8    4.8986   
7 . 18   23.4035  
7 . 8    7.8418   
8 . 16   5.0458   
8 . 6    4.8986   
8 . 7    7.8418   
8 . 9    5.0502   
9 . 10   13.9158  
9 . 5    10       
9 . 8    5.0502   
/;
      




PARAMETER ITEMTODISP(i,trip_index);


parameter ca(i,j), cb(i,j), ck(i,j);

ca(i,j)=a(i,j);
cb(i,j)=b(i,j);
ck(i,j)=c(i,j);

parameter c1111;
c1111=card(i);
parameter d1111;
d1111=card(trip_index);

alias(i,j,k,n);

variables  
t(i,j)    time to get from node i to node j
v(i,j)    time to traverse arc form i to j
y(i,j,k)  flow to k along arc i-j
x(i,j)    aggregate flow on arc i-j
objpnlp   objective for nlp formulation
objdnlp   objective for nlp formulation

positive variable y;

equations  balance(i,j)     material balance
           vdef(i,j)        arc travel time definition
           rational(i,j,k)  cost minimization condition
           xdef(i,j)        aggregate flow definition
           defpnlp          defines objective for primal nlp formulation
           defdnlp          defines objective for dual nlp formulation;


balance(i,k)$(not sameas(i,k))..  sum(links(i,j), y(links,k)) =e= sum(links(j,i), y(links,k)) + trip(i,k);

rational(links(i,j),k)$(not sameas(i,k))..   v(links) + t(j,k) =g= t(i,k);

vdef(links)..  v(links) =e= ca(links) + cb(links)*power(x(links)/ck(links),4);

xdef(links)..  x(links) =e= sum(k, y(links,k));

defpnlp..  objpnlp =e= sum(links, ca(links)*x(links) + cb(links)*power(x(links)/ck(links),5)*ck(links)/5);

defdnlp..  objdnlp =e= sum((i,k), trip(i,k)*t(i,k))
                     - sum(links, (4/5)*(ck(links)/cb(links)**(1/4))*(v(links)-ca(links))**1.25);
*primal nlp formulation 
model pnlp / defpnlp, balance, xdef/
*dual nlp formulation   
dnlp /defdnlp, rational /
*mcp formulation        
mcp  /rational.y, balance.t, xdef, vdef.v /;


*  mirror the values
*trip(i,j) $= trip(j,i);        
*  get it back to original values
trip(i,j)  = trip(i,j)*0.11;   
*  has to match the values in the article
option trip:2; 
display trip;   

*!  identify arcs using flow cost parameter a
*links(i,j) = ca(i,j);              
display links;
$stitle Bound Definitions and Solutions

t.fx(i,i)      = 0;
v.lo(links)        = ca(links);
y.fx(links(i,j),i) = 0;

option domlim=1000000;
pnlp.workfactor=3;

parameter rep(i,k,*) summary report;

mcp.OPTFILE = 1; 
solve mcp  using mcp;                    rep(i,j,'mcp   ') =  t.l(i,j);
*solve pnlp using nlp minimizing objpnlp; rep(i,j,'primal') =  balance.m(i,j);
*solve dnlp using nlp maximizing objdnlp; rep(i,j,'dual  ') =  t.l(i,j);

display rep;